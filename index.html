import React, { useState, useEffect } from 'react';
import { initializeApp } from 'firebase/app';
import { getFirestore, doc, onSnapshot, setDoc, collection, addDoc, getDocs, deleteDoc, updateDoc, query, where, orderBy } from 'firebase/firestore';
import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from 'firebase/auth';

// Definición de íconos SVG para los botones de navegación
const UserIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-user"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
);
const CalendarIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-calendar-days"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>
);
const DumbbellIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-dumbbell"><path d="m6.5 6.5 11 11"/><path d="m21 21-1-1"/><path d="m3 3 1 1"/><path d="m18 22 4-4"/><path d="m2 6 4-4"/><path d="m21 3-3 3"/><path d="m3 21 3-3"/><path d="M12 7v10"/><path d="M12 3v4"/><path d="M12 17v4"/></svg>
);
const HistoryIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-history"><path d="M3 3v5h5"/><path d="M3.05 13A9 9 0 1 0 5.9 5.9L3 8"/><path d="M12 7v6l4 2"/></svg>
);
const EditIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-pencil"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></svg>
);
const InfoIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-info"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
);

// Datos iniciales de ejercicios
const initialWorkoutData = {
    Lunes: [
        { name: 'Hip thrust', series: 4, reps: 8, description: 'Ejercicio para fortalecer glúteos y femorales.', instructions: 'Siéntate en el suelo con la espalda apoyada en un banco y una barra sobre tus caderas. Impulsa la cadera hacia arriba contrayendo los glúteos y baja de forma controlada.', weight: 0, status: 'pending', image: null },
        { name: 'Peso muerto', series: 3, reps: 10, description: 'Ejercicio compuesto para la espalda baja, glúteos, femorales y cuádriceps.', instructions: 'De pie, con los pies a la altura de los hombros, agarra la barra. Mantén la espalda recta, empuja las caderas hacia atrás y baja la barra hasta las rodillas o espinillas. Sube contrayendo glúteos.', weight: 0, status: 'pending', image: null },
        { name: 'Sentadilla búlgara', series: 4, reps: 10, description: 'Ejercicio de una sola pierna para cuádriceps y glúteos.', instructions: 'Coloca un pie en un banco detrás de ti. Baja la cadera en un movimiento de sentadilla, manteniendo el torso erguido. El pie de adelante debe quedar con un ángulo de 90°.', weight: 0, status: 'pending', image: null },
        { name: 'Patada en polea', series: 3, reps: 10, description: 'Aisla los glúteos para fortalecerlos.', instructions: 'Colócate de frente a la polea y sujeta el mango en tu tobillo. Mantén el cuerpo estable y lleva la pierna hacia atrás, contrayendo el glúteo.', weight: 0, status: 'pending', image: null },
        { name: 'Femoral tumbado', series: 4, reps: 8, description: 'Aisla los femorales para un mayor desarrollo.', instructions: 'Acuéstate boca abajo en la máquina. Flexiona las rodillas para llevar los talones hacia los glúteos, contrayendo los femorales. Regresa lentamente.', weight: 0, status: 'pending', image: null },
    ],
    Martes: [
        { name: 'Jalón abierto', series: 3, reps: 12, description: 'Ejercicio para la amplitud de la espalda.', instructions: 'Agarra la barra con un agarre amplio. Jala la barra hacia tu pecho, llevando los codos hacia abajo. Sube de manera controlada.', weight: 0, status: 'pending', image: null },
        { name: 'Remo en máquina', series: 3, reps: 12, description: 'Ejercicio para la espalda media y el grosor.', instructions: 'Siéntate en la máquina de remo con la espalda recta. Jala el agarre hacia tu abdomen, juntando los omóplatos. Vuelve a la posición inicial controlando el peso.', weight: 0, status: 'pending', image: null },
        { name: 'Dominadas en máquina', series: 3, reps: 10, description: 'Ejercicio compuesto para la espalda superior.', instructions: 'Siéntate en la máquina de dominadas. Agarra la barra con un agarre amplio. Baja el peso hacia tu pecho, contrayendo tu espalda. Sube controladamente.', weight: 0, status: 'pending', image: null },
        { name: 'Curl de bíceps con barra', series: 3, reps: 10, description: 'Ejercicio básico para la masa del bíceps.', instructions: 'Agarra una barra con las manos a la altura de los hombros. Flexiona los codos para llevar la barra hacia tus hombros, contrayendo los bíceps. Baja controladamente.', weight: 0, status: 'pending', image: null },
        { name: 'Martillos', series: 3, reps: 10, description: 'Ejercicio para el desarrollo del braquial.', instructions: 'Agarra una mancuerna en cada mano, con las palmas mirando hacia tus muslos. Sube las pesas flexionando los codos, manteniendo las palmas hacia adentro. Baja controladamente.', weight: 0, status: 'pending', image: null },
        { name: 'Cardio', series: 1, reps: 1, description: '15-20 minutos de escaladora o caminadora.', instructions: 'Mantén un ritmo constante que te permita hablar, pero que suponga un esfuerzo.', weight: 0, status: 'pending', image: null },
    ],
    Miércoles: [
        { name: 'Sentadilla en Smith', series: 4, reps: 10, description: 'Sentadilla guiada que trabaja los cuádriceps y glúteos.', instructions: 'Colócate debajo de la barra, apoyándola en tu espalda superior. Baja la cadera como si te sentaras en una silla, manteniendo la espalda recta. Sube con fuerza en las piernas.', weight: 0, status: 'pending', image: null },
        { name: 'Prensa', series: 4, reps: 8, description: 'Ejercicio para la fuerza de cuádriceps y femorales.', instructions: 'Siéntate en la máquina con la espalda apoyada. Coloca los pies en la plataforma. Empuja la plataforma hacia arriba y baja lentamente, manteniendo el control del peso.', weight: 0, status: 'pending', image: null },
        { name: 'Extensión de cuádriceps', series: 4, reps: 8, description: 'Aisla los cuádriceps para un mejor desarrollo.', instructions: 'Siéntate en la máquina y sujeta los rodillos con tus pies. Extiende las piernas contrayendo los cuádriceps. Baja lentamente y de forma controlada.', weight: 0, status: 'pending', image: null },
        { name: 'Máquina de abductores', series: 4, reps: 10, description: 'Fortalece los músculos de la cadera.', instructions: 'Siéntate en la máquina. Empuja los cojines hacia afuera con las rodillas, abriendo las piernas. Vuelve a la posición inicial lentamente.', weight: 0, status: 'pending', image: null },
        { name: 'Pantorrilla en Smith', series: 4, reps: 12, description: 'Desarrolla las pantorrillas.', instructions: 'Colócate en la máquina con los dedos de los pies en el borde. Sube y baja con los talones, contrayendo las pantorrillas.', weight: 0, status: 'pending', image: null },
    ],
    Jueves: [
        { name: 'Press militar', series: 4, reps: 8, description: 'Ejercicio compuesto para los hombros.', instructions: 'Siéntate en un banco con respaldo. Empuja las mancuernas por encima de tu cabeza hasta que tus brazos estén extendidos. Baja de manera controlada.', weight: 0, status: 'pending', image: null },
        { name: 'Elevaciones laterales', series: 3, reps: 10, description: 'Aisla el deltoides medio.', instructions: 'De pie, con una mancuerna en cada mano, levanta los brazos hacia los lados hasta que estén a la altura de los hombros. Baja controladamente.', weight: 0, status: 'pending', image: null },
        { name: 'Elevaciones frontales a un brazo en polea', series: 3, reps: 10, description: 'Aisla el deltoides frontal.', instructions: 'Agarra el mango de la polea y levanta el brazo hacia el frente hasta la altura del hombro. Baja de forma controlada.', weight: 0, status: 'pending', image: null },
        { name: 'Copa tríceps con mancuerna', series: 4, reps: 8, description: 'Ejercicio para la porción larga del tríceps.', instructions: 'Sujeta una mancuerna con ambas manos por encima de tu cabeza. Flexiona los codos para bajar la mancuerna detrás de tu cabeza y vuelve a subir estirando los brazos.', weight: 0, status: 'pending', image: null },
        { name: 'Extensión de tríceps con cuerda', series: 3, reps: 8, description: 'Ejercicio para la masa del tríceps.', instructions: 'Sujeta la cuerda de la polea con ambas manos. Empuja la cuerda hacia abajo hasta estirar los brazos por completo. Sube de forma controlada.', weight: 0, status: 'pending', image: null },
        { name: 'Extensión de tríceps en polea a una mano', series: 2, reps: 10, description: 'Ejercicio para el desarrollo del tríceps.', instructions: 'Agarra el mango de la polea con una mano. Estira el brazo hacia abajo, aislando el tríceps. Sube de forma controlada.', weight: 0, status: 'pending', image: null },
        { name: 'Cardio', series: 1, reps: 1, description: '15-20 minutos de escaladora o caminadora.', instructions: 'Mantén un ritmo constante que te permita hablar, pero que suponga un esfuerzo.', weight: 0, status: 'pending', image: null },
    ],
    Viernes: [
        { name: 'Hip thrust', series: 4, reps: 8, description: 'Ejercicio para glúteos y femorales.', instructions: 'Siéntate en el suelo con la espalda apoyada en un banco y una barra sobre tus caderas. Impulsa la cadera hacia arriba contrayendo los glúteos y baja de forma controlada.', weight: 0, status: 'pending', image: null },
        { name: 'Peso muerto rumano', series: 3, reps: 10, description: 'Trabaja la cadena posterior: femorales y glúteos.', instructions: 'De pie, con las piernas ligeramente flexionadas, inclina el torso hacia adelante manteniendo la espalda recta. Sube contrayendo glúteos y femorales.', weight: 0, status: 'pending', image: null },
        { name: 'Prensa', series: 4, reps: 10, description: 'Fuerza de cuádriceps y femorales.', instructions: 'Siéntate en la máquina con la espalda apoyada. Coloca los pies en la plataforma. Empuja la plataforma hacia arriba y baja lentamente, manteniendo el control del peso.', weight: 0, status: 'pending', image: null },
        { name: 'Extensión de cuádriceps', series: 4, reps: 8, description: 'Aisla los cuádriceps.', instructions: 'Siéntate en la máquina y sujeta los rodillos con tus pies. Extiende las piernas contrayendo los cuádriceps. Baja lentamente y de forma controlada.', weight: 0, status: 'pending', image: null },
        { name: 'Sentadilla en Smith', series: 4, reps: 8, description: 'Sentadilla guiada para cuádriceps y glúteos.', instructions: 'Colócate debajo de la barra, apoyándola en tu espalda superior. Baja la cadera como si te sentaras en una silla, manteniendo la espalda recta. Sube con fuerza en las piernas.', weight: 0, status: 'pending', image: null },
        { name: 'Máquina de abductores', series: 4, reps: 8, description: 'Fortalece los músculos de la cadera.', instructions: 'Siéntate en la máquina. Empuja los cojines hacia afuera con las rodillas, abriendo las piernas. Vuelve a la posición inicial lentamente.', weight: 0, status: 'pending', image: null },
        { name: 'Pantorrillas', series: 4, reps: 12, description: 'Desarrollo de pantorrillas.', instructions: 'Colócate en la máquina con los dedos de los pies en el borde. Sube y baja con los talones, contrayendo las pantorrillas.', weight: 0, status: 'pending', image: null },
    ],
};

const daysOfWeek = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes'];
const dayColors = {
    'Lunes': 'bg-rose-300 text-rose-800',
    'Martes': 'bg-indigo-300 text-indigo-800',
    'Miércoles': 'bg-emerald-300 text-emerald-800',
    'Jueves': 'bg-amber-300 text-amber-800',
    'Viernes': 'bg-cyan-300 text-cyan-800',
};
const dayFocus = {
    'Lunes': 'Pierna y glúteo',
    'Martes': 'Espalda y bíceps',
    'Miércoles': 'Pierna y glúteo',
    'Jueves': 'Hombro y tríceps',
    'Viernes': 'Pierna y glúteo',
};

// Configuración de Firebase
const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

function App() {
    const [view, setView] = useState('profile'); // Vista inicial
    const [userId, setUserId] = useState(null);
    const [db, setDb] = useState(null);
    const [auth, setAuth] = useState(null);
    const [profile, setProfile] = useState({});
    const [calendar, setCalendar] = useState({});
    const [workouts, setWorkouts] = useState(initialWorkoutData);
    const [history, setHistory] = useState([]);
    const [selectedDay, setSelectedDay] = useState(null);
    const [editingExercise, setEditingExercise] = useState(null);
    const [isEditModalOpen, setIsEditModalOpen] = useState(false);
    const [isInfoModalOpen, setIsInfoModalOpen] = useState(false);
    const [isImageModalOpen, setIsImageModalOpen] = useState(false);
    const [selectedImage, setSelectedImage] = useState(null);
    const [motivationalMessage, setMotivationalMessage] = useState(null);
    const [infoMessage, setInfoMessage] = useState(null);
    const [isAuthReady, setIsAuthReady] = useState(false);
    const [isEditingProfile, setIsEditingProfile] = useState(true); // Nuevo estado para el modo de edición del perfil
    const [currentCalendarDate, setCurrentCalendarDate] = useState(new Date());

    // Nombres de los meses en español para el calendario
    const months = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];

    // Inicializar Firebase y autenticar al usuario
    useEffect(() => {
        try {
            const app = initializeApp(firebaseConfig);
            const firestore = getFirestore(app);
            const firebaseAuth = getAuth(app);
            setDb(firestore);
            setAuth(firebaseAuth);

            // Manejar el inicio de sesión del usuario
            const handleAuth = async () => {
                if (initialAuthToken) {
                    await signInWithCustomToken(firebaseAuth, initialAuthToken);
                } else {
                    await signInAnonymously(firebaseAuth);
                }
            };
            handleAuth();

            const unsubscribeAuth = onAuthStateChanged(firebaseAuth, (user) => {
                if (user) {
                    setUserId(user.uid);
                    console.log("Authenticated with userId:", user.uid);
                } else {
                    setUserId(null);
                }
                setIsAuthReady(true);
            });

            return () => unsubscribeAuth();
        } catch (e) {
            console.error("Error initializing Firebase:", e);
        }
    }, [firebaseConfig, initialAuthToken]);

    // Escuchar los datos del usuario después de la autenticación
    useEffect(() => {
        if (!db || !userId) return;

        const workoutsDocRef = doc(db, "artifacts", appId, "users", userId, "data", "workouts");
        const profileDocRef = doc(db, "artifacts", appId, "users", userId, "data", "profile");
        const calendarDocRef = doc(db, "artifacts", appId, "users", userId, "data", "calendar");
        const historyCollectionRef = collection(db, "artifacts", appId, "users", userId, "workouts_history");

        const unsubWorkouts = onSnapshot(workoutsDocRef, (docSnapshot) => {
            if (docSnapshot.exists()) {
                setWorkouts(docSnapshot.data().workouts);
            } else {
                setDoc(workoutsDocRef, { workouts: initialWorkoutData });
            }
        }, (error) => console.error("Error listening to workouts:", error));

        const unsubProfile = onSnapshot(profileDocRef, (docSnapshot) => {
            if (docSnapshot.exists()) {
                const data = docSnapshot.data();
                setProfile({ ...data, gender: data.gender || 'female' });
                setIsEditingProfile(false); // Desactivar el modo de edición al cargar los datos
            } else {
                setDoc(profileDocRef, { gender: 'female' });
                setProfile({ gender: 'female' });
                setIsEditingProfile(true); // Activar el modo de edición si no hay datos
            }
        }, (error) => console.error("Error listening to profile:", error));

        const unsubCalendar = onSnapshot(calendarDocRef, (docSnapshot) => {
            if (docSnapshot.exists()) {
                setCalendar(docSnapshot.data());
            } else {
                setDoc(calendarDocRef, {}); // Inicializar si no existe
            }
        }, (error) => console.error("Error listening to calendar:", error));

        const unsubHistory = onSnapshot(historyCollectionRef, (querySnapshot) => {
            const historyData = [];
            querySnapshot.forEach((doc) => {
                historyData.push({ id: doc.id, ...doc.data() });
            });
            // Ordenar por fecha de forma descendente
            const sortedHistory = historyData.sort((a, b) => b.timestamp - a.timestamp);
            setHistory(sortedHistory);
        }, (error) => console.error("Error listening to history:", error));

        return () => {
            unsubWorkouts();
            unsubProfile();
            unsubCalendar();
            unsubHistory();
        };
    }, [db, userId]);

    const saveUserData = async (data) => {
        if (!db || !userId) return;
        try {
            const profileDocRef = doc(db, "artifacts", appId, "users", userId, "data", "profile");
            await setDoc(profileDocRef, data);
            setIsEditingProfile(false); // Desactivar el modo de edición después de guardar
        } catch (e) {
            console.error("Error al guardar los datos del perfil:", e);
        }
    };

    const saveCalendarData = async (data) => {
        if (!db || !userId) return;
        try {
            const calendarDocRef = doc(db, "artifacts", appId, "users", userId, "data", "calendar");
            await setDoc(calendarDocRef, data);
        } catch (e) {
            console.error("Error al guardar los datos del calendario:", e);
        }
    };

    const saveWorkouts = async (newWorkouts) => {
        if (!db || !userId) return;
        try {
            const workoutsDocRef = doc(db, "artifacts", appId, "users", userId, "data", "workouts");
            await setDoc(workoutsDocRef, { workouts: newWorkouts });
        } catch (e) {
            console.error("Error al guardar los ejercicios:", e);
        }
    };

    const handleProfileChange = (e) => {
        const { name, value } = e.target;
        if (name === 'weight' || name === 'height' || name === 'age') {
            setProfile(prev => ({ ...prev, [name]: parseFloat(value) || 0 }));
        } else {
            setProfile(prev => ({ ...prev, [name]: value }));
        }
    };

    // Función para calcular y clasificar el IMC y el peso excedente
    const calculateIMC = () => {
        const { weight, height } = profile;
        let imc = null;
        let classification = "N/A";
        let colorClass = "text-gray-700";
        let excessWeight = null;

        if (weight > 0 && height > 0) {
            const heightInMeters = height / 100;
            imc = weight / (heightInMeters * heightInMeters);

            if (imc < 18.5) {
                classification = "Peso insuficiente";
                colorClass = "text-red-500";
            } else if (imc >= 18.5 && imc <= 24.9) {
                classification = "Peso normal (saludable)";
                colorClass = "text-green-500";
            } else if (imc >= 25.0 && imc <= 29.9) {
                classification = "Sobrepeso";
                colorClass = "text-yellow-500";
            } else {
                classification = "Obesidad";
                colorClass = "text-red-500";
            }

            // Calcular el peso ideal y el peso excedente
            const maxHealthyWeight = 24.9 * (heightInMeters * heightInMeters);
            if (imc > 24.9) {
                excessWeight = (weight - maxHealthyWeight).toFixed(1);
            }
        }
        return { imc: imc ? imc.toFixed(2) : "N/A", classification, colorClass, excessWeight };
    };

    const handleCalendarClick = async (date) => {
        const newCalendar = { ...calendar };
        const currentState = newCalendar[date] || 'none';
        newCalendar[date] = currentState === 'none' ? 'tick' : (currentState === 'tick' ? 'cross' : 'none');
        await saveCalendarData(newCalendar);
    };

    const handleExerciseToggle = async (day, index) => {
        if (!db || !userId) return;
        const newWorkouts = { ...workouts };
        const exercise = newWorkouts[day][index];
        const oldStatus = exercise.status;
        let newStatus;

        if (oldStatus === 'pending') {
            newStatus = 'missed';
        } else if (oldStatus === 'missed') {
            newStatus = 'completed';
        } else {
            newStatus = 'pending';
        }

        const today = new Date().toISOString().split('T')[0];
        const historyCollectionRef = collection(db, "artifacts", appId, "users", userId, "workouts_history");

        // Si el nuevo estado es 'completed', agregar al historial
        if (newStatus === 'completed') {
            const q = query(historyCollectionRef, 
                where('name', '==', exercise.name),
                where('date', '==', today)
            );
            const querySnapshot = await getDocs(q);
            if (querySnapshot.empty) {
                await addDoc(historyCollectionRef, {
                    ...exercise,
                    status: newStatus,
                    date: today,
                    timestamp: Date.now(),
                    action: 'completed'
                });
                setInfoMessage("¡Ejercicio completado y registrado!");
            } else {
                setInfoMessage("Este ejercicio ya fue completado hoy. No se registrará de nuevo.");
            }
        }
        
        // Si el estado anterior era 'completed' y el nuevo no lo es, eliminar del historial
        if (oldStatus === 'completed' && (newStatus === 'pending' || newStatus === 'missed')) {
            const q = query(historyCollectionRef, 
                where('name', '==', exercise.name),
                where('date', '==', today)
            );
            const querySnapshot = await getDocs(q);
            if (!querySnapshot.empty) {
                querySnapshot.forEach(async (doc) => {
                    await deleteDoc(doc.ref);
                });
                setInfoMessage("Ejercicio eliminado del historial.");
            }
        }

        exercise.status = newStatus;
        await saveWorkouts(newWorkouts);
    };

    const handleWeightChange = (day, index, value) => {
        const newWorkouts = { ...workouts };
        newWorkouts[day][index].weight = parseFloat(value) || 0;
        saveWorkouts(newWorkouts);
    };

    const getProgress = (day) => {
        const dayWorkouts = workouts[day] || [];
        const completed = dayWorkouts.filter(ex => ex.status === 'completed').length;
        const total = dayWorkouts.length;
        return total > 0 ? (completed / total) * 100 : 0;
    };

    const handleEditExercise = (day, index) => {
        const exercise = workouts[day][index];
        setEditingExercise({ ...exercise, day, index });
        setIsEditModalOpen(true);
    };

    const handleAddExercise = (day) => {
        setEditingExercise({ day, index: null, name: '', series: '', reps: '', description: '', instructions: '', image: null, weight: 0, status: 'pending' });
        setIsEditModalOpen(true);
    };

    const handleDeleteExercise = async (day, index) => {
        const historyCollectionRef = collection(db, "artifacts", appId, "users", userId, "workouts_history");
        await addDoc(historyCollectionRef, {
            ...workouts[day][index],
            date: new Date().toISOString().split('T')[0],
            timestamp: Date.now(),
            action: 'deleted'
        });

        const newWorkouts = { ...workouts };
        newWorkouts[day].splice(index, 1);
        await saveWorkouts(newWorkouts);
        setInfoMessage("¡Ejercicio eliminado!");
    };

    const handleDeleteHistoryItem = async (id) => {
        if (!db || !userId) return;
        try {
            const historyDocRef = doc(db, "artifacts", appId, "users", userId, "workouts_history", id);
            await deleteDoc(historyDocRef);
            setInfoMessage("Entrada del historial eliminada.");
        } catch (e) {
            console.error("Error al eliminar la entrada del historial:", e);
            setInfoMessage("Error al eliminar la entrada del historial.");
        }
    };

    const handleImageUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onloadend = () => {
                setEditingExercise(prev => ({ ...prev, image: reader.result }));
            };
            reader.readAsDataURL(file);
        }
    };

    const handleSaveExercise = async () => {
        if (!editingExercise.name) return;
        const newWorkouts = { ...workouts };
        const { day, index, ...rest } = editingExercise;
        if (index !== null) {
            newWorkouts[day][index] = rest;
        } else {
            newWorkouts[day] = [...newWorkouts[day], rest];
        }
        await saveWorkouts(newWorkouts);
        setIsEditModalOpen(false);
        setEditingExercise(null);
        setInfoMessage("¡Ejercicio guardado exitosamente!");
    };

    const handleInfoClick = (exercise) => {
        setEditingExercise(exercise);
        setIsInfoModalOpen(true);
    };

    const closeInfoModal = () => {
        setIsInfoModalOpen(false);
        setEditingExercise(null);
    };

    const handleImageClick = (image) => {
        setSelectedImage(image);
        setIsImageModalOpen(true);
    };

    const closeImageModal = () => {
        setIsImageModalOpen(false);
        setSelectedImage(null);
    };
    
    const getCalendarDates = (date) => {
        const year = date.getFullYear();
        const month = date.getMonth();
        const firstDayOfMonth = new Date(year, month, 1);
        const lastDayOfMonth = new Date(year, month + 1, 0);
        const dates = [];

        const firstDayIndex = firstDayOfMonth.getDay();
        for (let i = 0; i < firstDayIndex; i++) {
            dates.push(null);
        }

        for (let i = 1; i <= lastDayOfMonth.getDate(); i++) {
            dates.push(new Date(year, month, i).toISOString().split('T')[0]);
        }
        return dates;
    };

    const getAttendanceStats = (currentMonth) => {
        const attendance = { assisted: 0, missed: 0 };
        const monthDates = Object.keys(calendar).filter(date => {
            const d = new Date(date);
            return d.getFullYear() === currentMonth.getFullYear() && d.getMonth() === currentMonth.getMonth();
        });

        monthDates.forEach(date => {
            if (calendar[date] === 'tick') {
                attendance.assisted++;
            } else if (calendar[date] === 'cross') {
                attendance.missed++;
            }
        });
        return attendance;
    };


    useEffect(() => {
        if (selectedDay) {
            const progress = getProgress(selectedDay);
            if (progress === 100) {
                setMotivationalMessage("¡Felicidades, has completado todos los ejercicios de hoy!");
            } else {
                setMotivationalMessage(null);
            }
        }
    }, [workouts, selectedDay]);

    const renderView = () => {
        switch (view) {
            case 'profile':
                const { imc, classification, colorClass, excessWeight } = calculateIMC();
                return (
                    <div className="p-6 w-full">
                        <h2 className="text-3xl font-bold text-pink-800 mb-6">Mi Perfil</h2>
                        {!isEditingProfile ? (
                            <div className="space-y-4">
                                <div className="bg-white p-6 rounded-lg shadow-md border border-gray-200">
                                    <h3 className="text-xl font-bold text-gray-800">Datos Personales</h3>
                                    <p className="mt-2 text-md text-gray-600">Género: <span className="font-semibold">{profile.gender === 'female' ? 'Mujer' : 'Hombre'}</span></p>
                                    <p className="text-md text-gray-600">Edad: <span className="font-semibold">{profile.age || 'N/A'}</span></p>
                                    <p className="text-md text-gray-600">Peso: <span className="font-semibold">{profile.weight || 'N/A'} kg</span></p>
                                    <p className="text-md text-gray-600">Altura: <span className="font-semibold">{profile.height || 'N/A'} cm</span></p>
                                </div>
                                <div className="bg-purple-100 p-6 rounded-lg shadow-inner">
                                    <h3 className="text-xl font-bold text-purple-800">Tu Índice de Masa Corporal</h3>
                                    <p className="mt-2 text-lg font-bold">IMC: <span className="font-bold text-2xl">{imc}</span></p>
                                    <p className={`mt-2 text-lg font-bold ${colorClass}`}>Clasificación: {classification}</p>
                                    {excessWeight && (
                                        <p className="mt-2 text-lg font-bold text-red-500">
                                            Estás {excessWeight} kg por encima del peso ideal.
                                        </p>
                                    )}
                                </div>
                                <button
                                    onClick={() => setIsEditingProfile(true)}
                                    className="px-6 py-3 bg-purple-500 text-white rounded-lg shadow-md transition-transform transform hover:scale-105 flex items-center space-x-2"
                                >
                                    <EditIcon />
                                    <span>Editar</span>
                                </button>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-gray-700 font-medium">Género</label>
                                    <select
                                        name="gender"
                                        value={profile.gender || 'female'}
                                        onChange={handleProfileChange}
                                        className="mt-1 p-2 w-full rounded-md border-gray-300 shadow-sm focus:ring-purple-500 focus:border-purple-500"
                                    >
                                        <option value="female">Mujer</option>
                                        <option value="male">Hombre</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-gray-700 font-medium">Edad</label>
                                    <input
                                        type="number"
                                        name="age"
                                        value={profile.age || ''}
                                        onChange={handleProfileChange}
                                        className="mt-1 p-2 w-full rounded-md border-gray-300 shadow-sm focus:ring-purple-500 focus:border-purple-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-gray-700 font-medium">Peso (kg)</label>
                                    <input
                                        type="number"
                                        name="weight"
                                        value={profile.weight || ''}
                                        onChange={handleProfileChange}
                                        className="mt-1 p-2 w-full rounded-md border-gray-300 shadow-sm focus:ring-purple-500 focus:border-purple-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-gray-700 font-medium">Altura (cm)</label>
                                    <input
                                        type="number"
                                        name="height"
                                        value={profile.height || ''}
                                        onChange={handleProfileChange}
                                        className="mt-1 p-2 w-full rounded-md border-gray-300 shadow-sm focus:ring-purple-500 focus:border-purple-500"
                                    />
                                </div>
                                <div className="flex justify-end mt-6">
                                    <button
                                        onClick={() => saveUserData(profile)}
                                        className="px-6 py-3 bg-pink-500 text-white rounded-lg shadow-md transition-transform transform hover:scale-105"
                                    >
                                        Guardar
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                );
            case 'calendar':
                const dates = getCalendarDates(currentCalendarDate);
                const today = new Date().toISOString().split('T')[0];
                const attendance = getAttendanceStats(currentCalendarDate);

                return (
                    <div className="p-6 w-full">
                        <h2 className="text-3xl font-bold text-pink-800 mb-6">Calendario</h2>
                        <div className="flex justify-between items-center mb-6">
                            <button 
                                className="bg-indigo-500 hover:bg-indigo-600 text-white p-2 rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                                onClick={() => setCurrentCalendarDate(new Date(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth() - 1, 1))}
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 19l-7-7 7-7" />
                                </svg>
                            </button>
                            <div className="text-xl sm:text-2xl font-bold text-center capitalize">
                                {months[currentCalendarDate.getMonth()]} {currentCalendarDate.getFullYear()}
                            </div>
                            <button 
                                className="bg-indigo-500 hover:bg-indigo-600 text-white p-2 rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                                onClick={() => setCurrentCalendarDate(new Date(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth() + 1, 1))}
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7" />
                                </svg>
                            </button>
                        </div>
                        <div className="grid grid-cols-7 text-center font-semibold text-sm sm:text-base text-gray-500 dark:text-gray-400 mb-4">
                            <span>Dom</span>
                            <span>Lun</span>
                            <span>Mar</span>
                            <span>Mié</span>
                            <span>Jue</span>
                            <span>Vie</span>
                            <span>Sáb</span>
                        </div>
                        <div className="grid grid-cols-7 gap-2">
                            {dates.map((date, index) => (
                                <button
                                    key={index}
                                    className={`p-2 rounded-lg aspect-square flex items-center justify-center shadow-md transition-transform transform hover:scale-105
                                        ${date === today ? 'bg-indigo-500 text-white font-bold' : ''}
                                        ${calendar[date] === 'tick' ? 'bg-green-300 text-green-800' :
                                            calendar[date] === 'cross' ? 'bg-red-300 text-red-800' : 'bg-gray-100 text-gray-800'}`}
                                    onClick={() => date && handleCalendarClick(date)}
                                    disabled={!date}
                                >
                                    {date ? new Date(date).getDate() : ''}
                                    {calendar[date] === 'tick' && <span className="ml-1 text-2xl">✓</span>}
                                    {calendar[date] === 'cross' && <span className="ml-1 text-2xl">✗</span>}
                                </button>
                            ))}
                        </div>
                        <div className="mt-8 bg-white p-6 rounded-lg shadow-md border border-gray-200">
                            <h3 className="text-xl font-bold text-gray-800 mb-4">Resumen de Asistencias</h3>
                            <p className="text-md text-gray-600 mb-2">Asistencias: <span className="font-semibold text-green-600">{attendance.assisted}</span></p>
                            <p className="text-md text-gray-600">Faltas: <span className="font-semibold text-red-600">{attendance.missed}</span></p>
                        </div>
                    </div>
                );
            case 'weekly-plan':
                if (!selectedDay) {
                    return (
                        <div className="p-6 w-full">
                            <h2 className="text-3xl font-bold text-pink-800 mb-6">Mi Semana</h2>
                            <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6">
                                {daysOfWeek.map(day => (
                                    <button
                                        key={day}
                                        className={`flex flex-col items-center justify-center p-6 rounded-2xl shadow-lg transition-transform transform hover:scale-105
                                            ${dayColors[day]}`}
                                        onClick={() => { setSelectedDay(day); }}
                                    >
                                        <span className="font-bold text-2xl">{day}</span>
                                        <span className="mt-2 text-center text-sm font-semibold opacity-80">{dayFocus[day]}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    );
                }
                const dayWorkouts = workouts[selectedDay] || [];
                const progress = getProgress(selectedDay);

                return (
                    <div className="p-6 w-full">
                        <div className="flex flex-row flex-wrap justify-center sm:justify-start gap-2 mb-6 overflow-x-auto pb-2">
                            {daysOfWeek.map(day => (
                                <button
                                    key={day}
                                    onClick={() => setSelectedDay(day)}
                                    className={`px-4 py-2 rounded-full font-semibold transition-colors text-sm
                                        ${selectedDay === day ? 'bg-pink-500 text-white shadow-md' : 'bg-pink-100 text-pink-800 hover:bg-pink-200'}`}
                                >
                                    {day}
                                </button>
                            ))}
                            <button
                                onClick={() => setSelectedDay(null)}
                                className="px-4 py-2 rounded-full font-semibold transition-colors text-sm bg-gray-200 text-gray-800 hover:bg-gray-300"
                            >
                                Regresar
                            </button>
                        </div>
                        <h2 className="text-3xl font-bold text-pink-800 mb-6">{selectedDay}</h2>
                        {motivationalMessage && (
                            <div className="bg-green-100 text-green-800 p-4 rounded-lg shadow-inner mb-4 text-center font-semibold">
                                {motivationalMessage}
                            </div>
                        )}
                        {infoMessage && (
                            <div className="bg-blue-100 text-blue-800 p-4 rounded-lg shadow-inner mb-4 text-center font-semibold">
                                {infoMessage}
                            </div>
                        )}
                        <div className="w-full bg-gray-200 rounded-full h-4 mb-4">
                            <div
                                className="bg-teal-500 h-4 rounded-full transition-all duration-500"
                                style={{ width: `${progress}%` }}
                            ></div>
                        </div>
                        <div className="space-y-4">
                            {dayWorkouts.map((exercise, index) => (
                                <div key={index} className="bg-pink-100 p-4 rounded-lg shadow-md flex items-center justify-between">
                                    <div className="flex-1">
                                        <div className="flex items-center space-x-2">
                                            <button
                                                className={`text-2xl font-bold p-1 rounded-full w-8 h-8 flex items-center justify-center transition-colors duration-200
                                                    ${exercise.status === 'completed' ? 'bg-green-400 text-green-900' :
                                                        exercise.status === 'missed' ? 'bg-red-400 text-red-900' : 'bg-gray-300 text-gray-700'}`
                                                }
                                                onClick={() => handleExerciseToggle(selectedDay, index)}
                                            >
                                                {exercise.status === 'completed' && '✓'}
                                                {exercise.status === 'missed' && '✗'}
                                                {exercise.status === 'pending' && '-'}
                                            </button>
                                            <div className="flex-1">
                                                <h3 className="font-semibold text-xl">{exercise.name}</h3>
                                                <p className="text-sm text-gray-600">{exercise.series} series de {exercise.reps} repeticiones</p>
                                            </div>
                                            {exercise.instructions && (
                                                <button onClick={() => handleInfoClick(exercise)} className="text-gray-500 hover:text-gray-800">
                                                    <InfoIcon />
                                                </button>
                                            )}
                                        </div>
                                        {exercise.description && <p className="text-sm italic mt-2">{exercise.description}</p>}
                                        <div className="mt-2 flex items-center space-x-2">
                                            <span className="text-sm text-gray-700">Peso usado:</span>
                                            <input
                                                type="number"
                                                value={exercise.weight || ''}
                                                onChange={(e) => handleWeightChange(selectedDay, index, e.target.value)}
                                                className="w-20 p-1 rounded-md border-gray-300 shadow-sm text-sm"
                                            />
                                            <span className="text-sm text-gray-700">kg</span>
                                        </div>
                                        {exercise.image && (
                                            <div className="mt-4">
                                                <img
                                                    src={exercise.image}
                                                    alt={exercise.name}
                                                    className="w-24 h-24 object-cover rounded-lg cursor-pointer"
                                                    onClick={() => handleImageClick(exercise.image)}
                                                />
                                            </div>
                                        )}
                                    </div>
                                    <div className="flex space-x-2">
                                        <button
                                            onClick={() => handleEditExercise(selectedDay, index)}
                                            className="p-2 bg-purple-300 text-purple-900 rounded-full hover:bg-purple-400"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></svg>
                                        </button>
                                        <button
                                            onClick={() => handleDeleteExercise(selectedDay, index)}
                                            className="p-2 bg-red-300 text-red-900 rounded-full hover:bg-red-400"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                                        </button>
                                    </div>
                                </div>
                            ))}
                            <button
                                onClick={() => handleAddExercise(selectedDay)}
                                className="w-full px-4 py-2 mt-4 bg-teal-500 text-white font-bold rounded-lg shadow-md hover:bg-teal-600 transition-transform transform hover:scale-105"
                            >
                                + Agregar Ejercicio
                            </button>
                        </div>
                    </div>
                );
            case 'history':
                return (
                    <div className="p-6 w-full">
                        <h2 className="text-3xl font-bold text-blue-800 mb-6">Historial de Ejercicios</h2>
                        {infoMessage && (
                            <div className="bg-blue-100 text-blue-800 p-4 rounded-lg shadow-inner mb-4 text-center font-semibold">
                                {infoMessage}
                            </div>
                        )}
                        <div className="space-y-4">
                            {history.length > 0 ? (
                                history.map((item) => (
                                    <div key={item.id} className="bg-blue-100 p-4 rounded-lg shadow-md flex items-center justify-between">
                                        <div className="flex-1">
                                            <div className="flex items-center space-x-2">
                                                <span className={`text-2xl font-bold ${item.action === 'completed' ? 'text-green-700' : 'text-red-700'}`}>
                                                    {item.action === 'completed' ? '✓' : '✗'}
                                                </span>
                                                <div>
                                                    <h3 className="font-semibold text-xl">{item.name}</h3>
                                                    <p className="text-sm text-gray-600">
                                                        <span className="capitalize">{item.action === 'completed' ? 'Completado' : 'Eliminado'}</span> el {item.date}
                                                    </p>
                                                    {item.weight > 0 && (
                                                        <p className="text-sm text-gray-700">Peso: {item.weight}kg</p>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                        <button
                                            onClick={() => handleDeleteHistoryItem(item.id)}
                                            className="p-2 bg-red-300 text-red-900 rounded-full hover:bg-red-400"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                                        </button>
                                    </div>
                                ))
                            ) : (
                                <p className="text-center text-gray-500 italic">No hay ejercicios en el historial aún.</p>
                            )}
                        </div>
                    </div>
                );
            default:
                return <div className="p-6 w-full"><h2 className="text-xl font-bold text-center">Selecciona una opción del menú lateral.</h2></div>;
        }
    };

    return (
        <div className="flex min-h-screen bg-pink-50 text-gray-800 font-sans">
            <style>
                {`
                    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
                    body { font-family: 'Inter', sans-serif; }
                `}
            </style>
            <script src="https://cdn.tailwindcss.com"></script>
            <meta name="viewport" content="width=device-width, initial-scale=1.0" />
            
            {/* Barra lateral de navegación */}
            <nav className="w-64 bg-pink-200 text-pink-800 p-6 flex flex-col items-center shadow-lg">
                <h1 className="text-xl font-bold mb-8">Compañero De Gimnasio</h1>
                <div className="flex flex-col space-y-4 w-full">
                    <button
                        className={`flex items-center space-x-3 px-4 py-3 rounded-lg font-semibold transition-colors
                            ${view === 'profile' ? 'bg-white text-pink-800 shadow-md' : 'hover:bg-pink-100'}`}
                        onClick={() => { setView('profile'); setInfoMessage(null); setSelectedDay(null); }}
                    >
                        <UserIcon />
                        <span>Mi Perfil</span>
                    </button>
                    <button
                        className={`flex items-center space-x-3 px-4 py-3 rounded-lg font-semibold transition-colors
                            ${view === 'weekly-plan' || view === 'day-workout' ? 'bg-white text-pink-800 shadow-md' : 'hover:bg-pink-100'}`}
                        onClick={() => { setView('weekly-plan'); setInfoMessage(null); setSelectedDay(null); }}
                    >
                        <DumbbellIcon />
                        <span>Plan Semanal</span>
                    </button>
                    <button
                        className={`flex items-center space-x-3 px-4 py-3 rounded-lg font-semibold transition-colors
                            ${view === 'calendar' ? 'bg-white text-pink-800 shadow-md' : 'hover:bg-pink-100'}`}
                        onClick={() => { setView('calendar'); setInfoMessage(null); setSelectedDay(null); }}
                    >
                        <CalendarIcon />
                        <span>Calendario</span>
                    </button>
                    <button
                        className={`flex items-center space-x-3 px-4 py-3 rounded-lg font-semibold transition-colors
                            ${view === 'history' ? 'bg-white text-pink-800 shadow-md' : 'hover:bg-pink-100'}`}
                        onClick={() => { setView('history'); setInfoMessage(null); setSelectedDay(null); }}
                    >
                        <HistoryIcon />
                        <span>Historial</span>
                    </button>
                </div>
            </nav>

            {/* Contenido principal */}
            <main className="flex-1 py-8 overflow-y-auto">
                {renderView()}
            </main>

            {isEditModalOpen && (
                <div className="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className="bg-white p-6 rounded-lg shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto">
                        <h3 className="text-2xl font-bold text-pink-800 mb-4">{editingExercise.index !== null ? 'Editar Ejercicio' : 'Agregar Ejercicio'}</h3>
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700">Nombre</label>
                                <input
                                    type="text"
                                    value={editingExercise.name}
                                    onChange={(e) => setEditingExercise(prev => ({ ...prev, name: e.target.value }))}
                                    className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-purple-500 focus:border-purple-500"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700">Series</label>
                                <input
                                    type="number"
                                    value={editingExercise.series}
                                    onChange={(e) => setEditingExercise(prev => ({ ...prev, series: e.target.value }))}
                                    className="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700">Repeticiones</label>
                                <input
                                    type="number"
                                    value={editingExercise.reps}
                                    onChange={(e) => setEditingExercise(prev => ({ ...prev, reps: e.target.value }))}
                                    className="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700">Explicación breve</label>
                                <textarea
                                    value={editingExercise.description}
                                    onChange={(e) => setEditingExercise(prev => ({ ...prev, description: e.target.value }))}
                                    className="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
                                    rows="2"
                                ></textarea>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700">Instrucciones</label>
                                <textarea
                                    value={editingExercise.instructions}
                                    onChange={(e) => setEditingExercise(prev => ({ ...prev, instructions: e.target.value }))}
                                    className="mt-1 block w-full rounded-md border-gray-300 shadow-sm"
                                    rows="4"
                                ></textarea>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700">Subir imagen</label>
                                <input
                                    type="file"
                                    accept="image/*"
                                    onChange={handleImageUpload}
                                    className="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100"
                                />
                                {editingExercise.image && (
                                    <div className="mt-4">
                                        <img src={editingExercise.image} alt="Vista previa" className="w-24 h-24 object-cover rounded-lg" />
                                    </div>
                                )}
                            </div>
                        </div>
                        <div className="mt-6 flex justify-end space-x-2">
                            <button
                                onClick={() => setIsEditModalOpen(false)}
                                className="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400"
                            >
                                Cancelar
                            </button>
                            <button
                                onClick={handleSaveExercise}
                                className="px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600"
                            >
                                Guardar
                            </button>
                        </div>
                    </div>
                </div>
            )}

            {isInfoModalOpen && editingExercise && (
                <div className="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className="bg-white p-6 rounded-lg shadow-xl w-full max-w-md">
                        <h3 className="text-2xl font-bold text-pink-800 mb-4">{editingExercise.name}</h3>
                        <p className="text-gray-700 mb-4">{editingExercise.instructions}</p>
                        <div className="flex justify-end">
                            <button
                                onClick={closeInfoModal}
                                className="px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600"
                            >
                                Cerrar
                            </button>
                        </div>
                    </div>
                </div>
            )}
            
            {isImageModalOpen && (
                <div className="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center p-4 z-50" onClick={closeImageModal}>
                    <div className="max-w-full max-h-full">
                        <img src={selectedImage} alt="Imagen ampliada" className="rounded-lg max-w-full max-h-[90vh]" />
                    </div>
                    <button onClick={closeImageModal} className="absolute top-4 right-4 text-white text-3xl font-bold">×</button>
                </div>
            )}
        </div>
    );
}

export default App;
